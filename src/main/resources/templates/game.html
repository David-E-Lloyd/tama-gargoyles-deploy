<!-- src/main/resources/templates/game.html -->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tama Gargoyles - Game</title>

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/game.css}" href="/css/game.css" />
</head>

<body>
<main id="main" class="screen">

    <!-- ROW 1: TOP INFO BAR -->
    <header class="hud-top" aria-label="Gargoyle overview">
        <div class="hud-top__left">
            <h1 class="game-title">Tama Gargoyles</h1>

            <div class="meta" aria-label="Creature metadata">
                <span><strong>Creature:</strong> <span th:text="${gargoyle.name}">Pebble</span></span>
                <span><strong>Stage:</strong> <span th:text="${gargoyle.type}">CHILD</span></span>
            </div>
        </div>

        <div class="hud-top__right">
            <div class="meta">
        <span>
          <strong>Age:</strong>
          Day <span th:text="${gameDaysOld}">0</span>,
          Min <span th:text="${minutesIntoDay}">0</span>
        </span>

                <span class="chip"
                      th:classappend="${gargoyle.paused} ? ' chip--warn' : ' chip--ok'">
          <span th:text="${gargoyle.paused} ? 'PAUSED' : 'RUNNING'">RUNNING</span>
        </span>
            </div>

            <nav class="hud-links" aria-label="Game links">
                <a th:href="@{/gargoyle/{id}/rename(id=${gargoyle.id})}">Rename</a>

                <a th:if="${gargoyle.type.name() == 'GOOD' or gargoyle.type.name() == 'BAD'}"
                   th:href="@{/battle}">
                    Battle
                </a>
            </nav>
        </div>
    </header>

    <!-- ROW 2: CREATURE AREA -->
    <section class="creature-area" aria-labelledby="creature-area-title">
        <h2 id="creature-area-title" class="sr-only">Creature</h2>

        <div class="creature-frame">
            <!-- Replace later with a real image: <img class="creature-sprite bob" ...> -->
            <div class="creature-placeholder bob" aria-hidden="true">
                <span th:text="${gargoyle.type}">CHILD</span>
            </div>

            <!-- Optional overlays -->
            <p class="overlay overlay--left" th:if="${gargoyle.hunger < 50}">
                âš  Hungry soon
            </p>

            <p class="overlay overlay--right"
               th:if="${gargoyle.hunger >= 60 and gargoyle.happiness >= 60}">
                âœ¨ Well cared for
            </p>
        </div>
    </section>

    <!-- ROW 3: STATS -->
    <section class="stats" aria-label="Stats">

        <!-- Health -->
        <div class="stat">
            <div class="stat__row">
                <span class="stat__label">Health</span>
                <span class="stat__value" th:text="${gargoyle.health} + '%'">90%</span>
            </div>

            <!-- Single th:class to avoid duplicate attribute parsing errors -->
            <div th:class="'meter'
                    + (${gargoyle.health lt 25} ? ' meter--danger'
                    : (${gargoyle.health lt 50} ? ' meter--warn' : ''))">
                <div class="meter__fill" th:style="'width:' + ${gargoyle.health} + '%'"></div>
            </div>

            <span class="sr-only"
                  th:text="${gargoyle.health < 25 ? 'Critical' : (gargoyle.health < 50 ? 'Warning' : 'OK')}">
                OK
            </span>
        </div>

        <!-- Hunger -->
        <div class="stat">
            <div class="stat__row">
                <span class="stat__label">Hunger</span>
                <span class="stat__value" th:text="${gargoyle.hunger} + '%'">62%</span>
            </div>

            <div th:class="'meter'
                    + (${gargoyle.hunger lt 25} ? ' meter--danger'
                    : (${gargoyle.hunger lt 50} ? ' meter--warn' : ''))">
                <div class="meter__fill" th:style="'width:' + ${gargoyle.hunger} + '%'"></div>
            </div>

            <span class="sr-only"
                  th:text="${gargoyle.hunger < 25 ? 'Critical' : (gargoyle.hunger < 50 ? 'Warning' : 'OK')}">
                OK
            </span>
        </div>

        <!-- Happiness -->
        <div class="stat">
            <div class="stat__row">
                <span class="stat__label">Happiness</span>
                <span class="stat__value" th:text="${gargoyle.happiness} + '%'">80%</span>
            </div>

            <div th:class="'meter'
                    + (${gargoyle.happiness lt 25} ? ' meter--danger'
                    : (${gargoyle.happiness lt 50} ? ' meter--warn' : ''))">
                <div class="meter__fill" th:style="'width:' + ${gargoyle.happiness} + '%'"></div>
            </div>

            <span class="sr-only"
                  th:text="${gargoyle.happiness < 25 ? 'Critical' : (gargoyle.happiness < 50 ? 'Warning' : 'OK')}">
                OK
            </span>
        </div>
    </section>

    <!-- ROW 4: ACTIONS -->
    <section class="actions" aria-label="Actions">

        <div class="actions__group" aria-labelledby="feed-title">
            <h3 id="feed-title">Feed</h3>
            <div class="actions__grid">

                <form action="/rocks-increase" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
                    <input type="hidden" name="strengthDelta" value="10"/>
                    <input type="hidden" name="speedDelta" value="-5"/>
                    <input type="hidden" name="intelligenceDelta" value="-5"/>
                    <input type="hidden" name="hungerDelta" value="10"/>
                    <button class="btn" type="submit" title="Feed Rocks: +Strength, -Speed, -Intelligence">Feed Rocks</button>
                </form>

                <form action="/bugs-increase" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
                    <input type="hidden" name="strengthDelta" value="-5"/>
                    <input type="hidden" name="speedDelta" value="10"/>
                    <input type="hidden" name="intelligenceDelta" value="-5"/>
                    <input type="hidden" name="hungerDelta" value="10"/>
                    <button class="btn" type="submit" title="Feed Bugs: +Speed, -Strength, -Intelligence">Feed Bugs</button>
                </form>

                <form action="/fruits-increase" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
                    <input type="hidden" name="strengthDelta" value="-5"/>
                    <input type="hidden" name="speedDelta" value="-5"/>
                    <input type="hidden" name="intelligenceDelta" value="10"/>
                    <input type="hidden" name="hungerDelta" value="10"/>
                    <button class="btn" type="submit" title="Feed Fruit: +Intelligence, -Strength, -Speed">Feed Fruit</button>
                </form>

                <form action="/mystery-increase" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
                    <input type="hidden" name="strengthDelta" value="0"/>
                    <input type="hidden" name="speedDelta" value="0"/>
                    <input type="hidden" name="intelligenceDelta" value="0"/>
                    <input type="hidden" name="hungerDelta" value="10"/>
                    <button class="btn" type="submit" title="Feed Mystery Food: ???">Feed Mystery</button>
                </form>

            </div>
        </div>

        <div class="actions__group" aria-labelledby="play-title">
            <h3 id="play-title">Play</h3>
            <div class="actions__grid">

                <form action="/strength-increase" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
                    <input type="hidden" name="strengthDelta" value="10"/>
                    <input type="hidden" name="speedDelta" value="0"/>
                    <input type="hidden" name="intelligenceDelta" value="0"/>
                    <input type="hidden" name="happinessDelta" value="10"/>
                    <button class="btn" type="submit" title="Play Strength Game: +Strength">Strength</button>
                </form>

                <form action="/speed-increase" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
                    <input type="hidden" name="strengthDelta" value="0"/>
                    <input type="hidden" name="speedDelta" value="10"/>
                    <input type="hidden" name="intelligenceDelta" value="0"/>
                    <input type="hidden" name="happinessDelta" value="10"/>
                    <button class="btn" type="submit" title="Play Speed Game: +Speed">Speed</button>
                </form>

                <form action="/intelligence-increase" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
                    <input type="hidden" name="strengthDelta" value="0"/>
                    <input type="hidden" name="speedDelta" value="0"/>
                    <input type="hidden" name="intelligenceDelta" value="10"/>
                    <input type="hidden" name="happinessDelta" value="10"/>
                    <button class="btn" type="submit" title="Play Intelligence Game: +Intelligence">Brains</button>
                </form>

            </div>
        </div>

        <div class="actions__group" aria-labelledby="time-title">
            <h3 id="time-title">Time</h3>
            <form th:action="@{/gargoyles/pause}" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button class="btn btn--primary btn--wide" type="submit">Pause &amp; Exit</button>
            </form>

            <p class="hint" th:if="${gargoyle.type.name() == 'CHILD'}">
                ðŸ”’ Battle unlocks when you evolve.
            </p>
        </div>

    </section>

    <!-- ROW 5: EVENT LOG (internal scroll, page stays fixed) -->
    <section class="log" aria-label="Event log">
        <h3>Event Log</h3>

        <ul class="log__list">
            <li th:if="${flashMessage}" th:text="${flashMessage}">You fed your gargoyle!</li>
            <li th:unless="${flashMessage}">Tip: refresh after ~1 minute to see decay while RUNNING.</li>
            <li th:if="${gargoyle.type.name() == 'CHILD'}">Battle unlocks when you become an adult.</li>
        </ul>

        <!-- Debug only when devMode == true -->
        <details class="debug" th:if="${devMode}">
            <summary>Debug</summary>
            <p><strong>Last Tick:</strong> <span th:text="${gargoyle.lastTickAt}">-</span></p>
            <p><strong>Paused At:</strong> <span th:text="${gargoyle.pausedAt}">-</span></p>
            <p><strong>Active Minutes:</strong> <span th:text="${gargoyle.activeMinutes}">0</span></p>
        </details>
    </section>

</main>
</body>
</html>
